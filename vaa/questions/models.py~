from django.db import models
from django.contrib.auth.models import User
from django.contrib.postgres.fields import JSONField

from vaa.utils import trunc

class Candidate(models.Model):
    user = models.ForeignKey(User)
    ssn = models.CharField(max_length=11)
    picture = models.ImageField(null=True, blank=True)
    blurb = models.TextField()

    def __unicode__(self):
        return self.user.get_full_name()


class Question(models.Model):
    order = models.IntegerField()
    active = models.BooleanField()

    def __unicode__(self):
        istext = self.questiontext_set.get(lang="IS")
        return trunc(istext.text, 30)


class QuestionText(models.Model):
    lang = models.CharField(max_length=2)
    text = models.TextField()
    question = models.ForeignKey(Question)

    def __unicode__(self):
        return trunc(self.text, 30)

class AnswerText(models.Model):
    lang = models.CharField(max_length=2)
    text = models.TextField()
    mod = models.IntegerField()

    def __unicode__(self):
        return self.text + ":" + unicode(self.mod)


class AnswerSheet(models.Model):
    timestamp = models.DateTimeField()
    candidate = models.ForeignKey(Candidate, null=True, blank=True)
    answers = JSONField()

    def __unicode__(self):
        return self.candidate.user.get_full_name()
